{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/my-classroom-app/src/app/history/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { supabase } from '@/utils/supabase';\r\nimport './history.css';\r\n\r\nexport default function History() {\r\n  const [bookings, setBookings] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetchHistory();\r\n  }, []);\r\n\r\n  const fetchHistory = async () => {\r\n    const { data: { session } } = await supabase.auth.getSession();\r\n    if (!session) return;\r\n\r\n    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á (Join table)\r\n    const { data, error } = await supabase\r\n      .from('bookings')\r\n      .select(`\r\n        *,\r\n        classrooms (name, image_url)\r\n      `)\r\n      .eq('user_id', session.user.id)\r\n      .order('created_at', { ascending: false }); // ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô\r\n\r\n    if (data) setBookings(data);\r\n    setLoading(false);\r\n  };\r\n\r\n  // --- üïí ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢ (‡∏û‡∏£‡∏∞‡πÄ‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤) ---\r\n  const formatThaiDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('th-TH', {\r\n      year: 'numeric',\r\n      month: 'short', // ‡∏´‡∏£‡∏∑‡∏≠ 'long' ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏ï‡πá‡∏°\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: false // üëà ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 24 ‡∏ä‡∏°. (‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤ AM/PM)\r\n    }) + ' ‡∏ô.';\r\n  };\r\n\r\n  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á\r\n  const handleCancel = async (bookingId: number) => {\r\n    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;\r\n\r\n    const { error } = await supabase.from('bookings').delete().eq('id', bookingId);\r\n    if (!error) {\r\n      alert('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');\r\n      fetchHistory(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà\r\n    }\r\n  };\r\n\r\n  if (loading) return <div style={{textAlign:'center', marginTop: '50px'}}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</div>;\r\n\r\n  return (\r\n    <main>\r\n      <div className=\"history-container\">\r\n        <h1>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>\r\n        <p>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>\r\n\r\n        <div className=\"table-wrapper\">\r\n          <table className=\"history-table\">\r\n            <thead>\r\n              <tr>\r\n                <th>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>\r\n                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏£‡∏¥‡πà‡∏° - ‡∏à‡∏ö)</th>\r\n                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {bookings.map((booking) => (\r\n                <tr key={booking.id}>\r\n                  <td>\r\n                    <div className=\"room-cell\">\r\n                      {booking.classrooms?.image_url && (\r\n                        <img src={booking.classrooms.image_url} alt=\"Room\" className=\"mini-thumb\" />\r\n                      )}\r\n                      <span>{booking.classrooms?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡πâ‡∏≠‡∏á'}</span>\r\n                    </div>\r\n                  </td>\r\n                  <td>\r\n                    {/* ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */}\r\n                    <div className=\"timestamp\">\r\n                      ‡πÄ‡∏£‡∏¥‡πà‡∏°: {formatThaiDate(booking.start_time)} <br/>\r\n                      ‡∏ñ‡∏∂‡∏á: {formatThaiDate(booking.end_time)}\r\n                    </div>\r\n                  </td>\r\n                  <td>\r\n                    <button className=\"btn-cancel-booking\" onClick={() => handleCancel(booking.id)}>\r\n                      ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏≠‡∏á ‚ùå\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n              {bookings.length === 0 && (\r\n                <tr><td colSpan={3} className=\"empty-state\">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;;AAMe,SAAS;;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IAClD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;6BAAC;YACR;QACF;4BAAG,EAAE;IAEL,MAAM,eAAe;QACnB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,uIAAQ,CAAC,IAAI,CAAC,UAAU;QAC5D,IAAI,CAAC,SAAS;QAEd,4CAA4C;QAC5C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,uIAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,CAAC;;;MAGT,CAAC,EACA,EAAE,CAAC,WAAW,QAAQ,IAAI,CAAC,EAAE,EAC7B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,IAAI,kBAAkB;QAEhE,IAAI,MAAM,YAAY;QACtB,WAAW;IACb;IAEA,uDAAuD;IACvD,MAAM,iBAAiB,CAAC;QACtB,MAAM,OAAO,IAAI,KAAK;QACtB,OAAO,KAAK,kBAAkB,CAAC,SAAS;YACtC,MAAM;YACN,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;YACR,QAAQ,MAAM,sCAAsC;QACtD,KAAK;IACP;IAEA,uBAAuB;IACvB,MAAM,eAAe,OAAO;QAC1B,IAAI,CAAC,QAAQ,kCAAkC;QAE/C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,uIAAQ,CAAC,IAAI,CAAC,YAAY,MAAM,GAAG,EAAE,CAAC,MAAM;QACpE,IAAI,CAAC,OAAO;YACV,MAAM;YACN,gBAAgB,iBAAiB;QACnC;IACF;IAEA,IAAI,SAAS,qBAAO,6LAAC;QAAI,OAAO;YAAC,WAAU;YAAU,WAAW;QAAM;kBAAG;;;;;;IAEzE,qBACE,6LAAC;kBACC,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;8BAAG;;;;;;8BACJ,6LAAC;8BAAE;;;;;;8BAEH,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAM,WAAU;;0CACf,6LAAC;0CACC,cAAA,6LAAC;;sDACC,6LAAC;sDAAG;;;;;;sDACJ,6LAAC;sDAAG;;;;;;sDACJ,6LAAC;sDAAG;;;;;;;;;;;;;;;;;0CAGR,6LAAC;;oCACE,SAAS,GAAG,CAAC,CAAC,wBACb,6LAAC;;8DACC,6LAAC;8DACC,cAAA,6LAAC;wDAAI,WAAU;;4DACZ,QAAQ,UAAU,EAAE,2BACnB,6LAAC;gEAAI,KAAK,QAAQ,UAAU,CAAC,SAAS;gEAAE,KAAI;gEAAO,WAAU;;;;;;0EAE/D,6LAAC;0EAAM,QAAQ,UAAU,EAAE,QAAQ;;;;;;;;;;;;;;;;;8DAGvC,6LAAC;8DAEC,cAAA,6LAAC;wDAAI,WAAU;;4DAAY;4DACjB,eAAe,QAAQ,UAAU;4DAAE;0EAAC,6LAAC;;;;;4DAAI;4DAC3C,eAAe,QAAQ,QAAQ;;;;;;;;;;;;8DAGzC,6LAAC;8DACC,cAAA,6LAAC;wDAAO,WAAU;wDAAqB,SAAS,IAAM,aAAa,QAAQ,EAAE;kEAAG;;;;;;;;;;;;2CAjB3E,QAAQ,EAAE;;;;;oCAuBpB,SAAS,MAAM,KAAK,mBACnB,6LAAC;kDAAG,cAAA,6LAAC;4CAAG,SAAS;4CAAG,WAAU;sDAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ5D;GArGwB;KAAA"}}]
}